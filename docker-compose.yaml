services:
  pwm:
    build: .  # Build the image from the Dockerfile
    restart: always
    ports:
      - "10443:10443"
      - "11443:11443"
      - "5222:5222"
      - "8801:8801"
      - "40000:40000"  # Delve debugging port
    volumes:
      - .:/root  # Mount the host 'pwm' directory to '/app' in the container
    working_dir: /root/pwm  # Set the working directory to where your Go project is
    command: bash -c "chmod +x /root/pwm/docker/entrypoint.sh && dlv debug --headless --listen=:40000 --api-version=2 --log --accept-multiclient -- /root/pwm/docker/entrypoint.sh"
    networks:
      - pwm_net

networks:
  pwm_net:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16
