version: "3"

######## 项目依赖的环境，启动项目之前要先启动此环境 #######
######## The environment that the project depends on, starting this environment before starting the project #######

services: 
  mysql:
    image: mysql:5.7
    container_name: mysql
    security_opt:
      - apparmor:unconfined
      - seccomp:unconfined  # Added seccomp to match the docker run command
    cap_add:
      - SYS_PTRACE  # Added to mimic the successful docker run command
    environment:
      # 时区上海 - Time zone Shanghai (Change if needed)
      #TZ: Asia/Shanghai
      MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD:-my_root_secret}
      MYSQL_DATABASE: teamgram
      MYSQL_USER: teamgram
      MYSQL_PASSWORD: ${DB_PASSWORD:-teamgram}
      # MYSQL_ALLOW_EMPTY_PASSWORD: "true"
    ports:
      - 127.0.0.1:3306:3306
    volumes:
      # 数据挂载 - Data mounting
      - ./data/mysql/data:/var/lib/mysql:Z
      - ./teamgramd/sql:/docker-entrypoint-initdb.d/:Z
      #- /etc/localtime:/etc/localtime
    command:  # Fixed command to ensure it is a list format
      - "--default-authentication-plugin=mysql_native_password"
      - "--character-set-server=utf8mb4"
      - "--collation-server=utf8mb4_general_ci"
      - "--explicit_defaults_for_timestamp=true"
      - "--lower_case_table_names=1"
    restart: always
    networks:
      - teamgram_net 

networks:
  teamgram_net:
    driver: bridge
